---
title: "Bank account churn classification"
author: "Arindam Baruah"
number-sections: true
toc: true
output: html_document
execute: 
  echo: false
  warning: false
  message: false
---

üè¶ üí∏

![Source: Medium](figure/fig1.png)

# What is a bank churn and why does it occur ? 

With the advent of digital banking, it has become extremely convenient for users to open a new bank account. As opposed to the age old tradition of submitting multiple documents and credit histories after visiting a bank, the process has been revamped by a great deal with an user needing less than 10 minutes to open an account in the comfort of their couches.

However, with digital banking, it has also become convenient for users to close a bank account, more commonly termed as a **"churn"**. While this may appear to be a win for consumers, it is however important to understand the reasons and the effects that entail from a bank churn.

::: {.callout-note}
# Reasons for a churn to occur
A bank account churn could occur for a multitiude of reasons which are important for banks to analyse to reduce attrition of customers and also remain competitive in the market. Some of the reasons are:

-   **Fees and Charges:** High fees or unexpected charges can prompt customers to switch banks. This may include monthly maintenance fees, ATM fees, overdraft fees, and other charges.
-   **Low Interest Rates:** If a bank offers low interest rates on savings accounts or certificates of deposit, customers might look for better opportunities elsewhere to maximize their returns.
-   **Poor Customer Service:** Inadequate customer service, long wait times, and unhelpful staff can lead to frustration and dissatisfaction, prompting customers to seek better service elsewhere.
-   **Branch Accessibility:** Limited access to physical branches or ATMs can be a significant factor. If a customer moves to an area where their current bank has limited presence, they might switch to a more accessible option.
-   **Technology and Online Services:** Customers may switch to a bank that provides better online and mobile banking services, as technology plays an increasingly crucial role in the banking experience.
-   **Incentives and Promotions:** Banks often attract new customers by offering promotions, bonuses, or better interest rates. Existing customers may churn to take advantage of these offers.
-   **Changes in Financial Needs:** As individuals' financial situations evolve, their banking needs may change. For example, a customer might require more advanced financial products, and if their current bank can't meet those needs, they may switch to a different institution.
-   **Mergers and Acquisitions:** Changes resulting from bank mergers or acquisitions, such as alterations in account terms, fees, or service quality, can drive customers to seek alternatives.
-   **Ethical or Social Reasons:** Some customers may choose to switch banks due to concerns about a bank's ethical practices, social responsibility, or involvement in controversial activities.
-   **Security Concerns:** If a bank experiences a security breach or if customers perceive their accounts to be at risk, they may opt to move their funds to a more secure institution.
-   **Better Financial Products:** Customers may switch banks to access better financial products, such as higher-interest savings accounts, more competitive loan rates, or improved credit card offerings.
-   **Life Events:** Major life events like marriage, divorce, retirement, or the death of a spouse can prompt individuals to reassess their banking relationships and switch to better-suited options.
:::



# Importing the relevant libraries and dataset 
::: panel-tabset
## Packages used

In order to initiate our analysis of the bank account data, we will read all the required libraries and then take a glimpse of how our data looks like.

```{r libraries, echo=TRUE,message=FALSE,warning=FALSE}
#| label: library

library(tidyverse)
library(naniar)
library(bookdown)
library(stringr)
library(stringi)
library(lubridate)
library(DT)
library(forcats)
library(ggthemes)
library(corrplot)
library(mltools)
library(data.table)
library(visdat)
library(janitor)
library(cowplot)
library(caTools)
library(pscl)
library(ROCR)
library(caret)
library(xgboost)
library(randomForest)
library(lightgbm)
library(Matrix)
library(catboost)
library(kableExtra)
library(plotly)
library(ggExtra)
```

## Dataset glimpse

```{r}
#| label: tbl-data
#| tbl-cap: "Bank churn dataset"
df_bank <- read_csv("data/train.csv")

kbl(head(df_bank)) %>% kable_paper(font_size = 9) %>%
  column_spec(14, bold = T, border_right = T) %>%
  column_spec(2, width = "30em", background = "yellow")

```
:::

# Data description

Based on a brief research, the description for each variable in the dataset is as follows:

1. __CustomerId:__ Unique identifier for each customer
2. __Surname:__ Name associated with the customer
3. __CreditScore:__ Credit score of the customer
4. __Geography:__ Location of the bank account based on geographical location of the bank
5. __Gender:__ Gender of the customer
6. __Age:__ Current age of the customer
7. __Tenure:__ Length of time since the opening of the bank account
8. __Balance:__ Current credit balance in the account
9. __NumOfProducts:__ Number of banking services used by the customer
10. __HasCrCard:__ An indicator for whether the customer has a credit card
11. __IsActiveMember:__ Is the customer a regular user of the bank account through transactions
12. __EstimatedSalary:__ Estimated earning declared as salary for the customer
13. __Exited:__ Has the customer closed the bank account

# Data cleaning

```{r}
#| label: fig-misvis
#| fig-cap: "Check for missing values in the dataset"
gg_miss_var(df_bank)
```
As we can observe from @fig-misvis, the dataset is clean and __does not have any missing values.__ While this is ideal, it is however not the only check that we must perform in the data.

# Data sanity checks
::: panel-tabset

## CustomerId

Since the customer ID is a unique identification reference number for
```{r}
#| label: tbl-occur
#| tbl-cap: "Number of occurrences of each customer"
df_bank %>% group_by(CustomerId) %>% summarise(Total_occurrences = n()) %>% arrange(-Total_occurrences) %>% head() %>% kbl()
```
Based on @tbl-occur, we can observe that the same customer ID appears multiple number of times in the dataset when infact, it was supposed to appear just once. Hence, we can consider the CustomerId variable to be serving no purpose in the current dataset. This shall be dropped in the feature selection section.


## Estimated Salary

The estimated salary variable indicates the income of each customer declared as a salary. __Salaries can never be negative.__ Let us quickly check if that indeed is the case.

```{r}
#| label: fig-salary
#| fig-cap: "Salary distribution of customers"
pl1 <- ggplot(data = df_bank,aes(x = EstimatedSalary)) + geom_histogram(alpha = 0.6,color = "orange") + theme_economist() + 
  labs(x = "Estimated annual salary ($)", y = "Number of customers",
       caption = "Visual by Arindam Baruah",title = "Annual salary distribution") + theme(plot.title = element_text(hjust = 0.5),
                                                                                          panel.background = element_rect(fill = "cornsilk")) 
pl1
```
Based on the histrogram of the salaries as illustrated by @fig-salary, we can observe that the salaries are __indeed positive which is what is expected.__

## Age

Bank account customers are generally required to be adults (> 18 years). We will check if that holds true for the current dataset and attempt to detect any anomalous data such as negative age.

```{r}
#| label: fig-age
#| fig-cap: "Age distribution of the bank customers"
pl2 <- ggplot(data = df_bank,aes(y = Age)) + geom_boxplot() + theme_economist() + 
  labs(y = "Age of customers (in years)",
       caption = "Visual by Arindam Baruah",title = "Age distribution") + theme(plot.title = element_text(hjust = 0.5),
                                                                                          panel.background = element_rect(fill = "cornsilk"),
                                                                                axis.text.x = element_blank(),axis.ticks.x = element_blank()) 
pl2
```
Based on @fig-age, we can observe that the data indeed suggests that the customers are of the right age (>18 years) and there are no anomalous data entries for this variable.


:::

